<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åŸºé‡‘å®æ—¶ä¼°å€¼ï¼ˆå…»åŸºå®é€»è¾‘ï¼‰</title>
<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
  background: #f6f7f9;
  padding: 15px;
}
h2 { text-align: center; }
.card {
  background: #fff;
  border-radius: 8px;
  padding: 15px;
  margin-bottom: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.06);
}
input {
  width: 100%;
  padding: 8px;
  margin-top: 6px;
  box-sizing: border-box;
}
button {
  width: 100%;
  margin-top: 12px;
  padding: 10px;
  background: #1677ff;
  color: #fff;
  border: none;
  border-radius: 6px;
  font-size: 16px;
}
.result {
  font-size: 18px;
  margin-top: 10px;
}
.small {
  color: #666;
  font-size: 13px;
}
</style>
</head>
<body>

<h2>ğŸ“Š åŸºé‡‘å®æ—¶ä¼°å€¼ï¼ˆå…»åŸºå®é€»è¾‘ï¼‰</h2>

<div class="card">
  <div class="small">æ˜¨æ—¥å•ä½å‡€å€¼</div>
  <input id="nav" type="number" step="0.0001" placeholder="ä¾‹å¦‚ 1.2356">

  <div class="small">è·Ÿè¸ªæŒ‡æ•° / ç»„åˆå½“æ—¥æ¶¨è·Œï¼ˆ%ï¼‰</div>
  <input id="indexRise" type="number" step="0.01" placeholder="ä¾‹å¦‚ 0.85">

  <div class="small">æ˜¨æ—¥å®˜æ–¹æ¶¨è·Œï¼ˆ%ï¼‰</div>
  <input id="officialRise" type="number" step="0.01" placeholder="ä¾‹å¦‚ 0.72">

  <button onclick="calc()">è®¡ç®—ä¼°å€¼</button>
</div>

<div class="card result" id="output">è¯·è¾“å…¥æ•°æ®</div>

<script>
/**
 * === å…»åŸºå® Lite æ ¸å¿ƒé€»è¾‘ ===
 * 1. ä»“ä½åæ¨
 * 2. å†å²å›å½’æ ¡å‡†
 * 3. å¹³æ»‘å¤„ç†
 */

function calc() {
  const nav = parseFloat(navInput.value);
  const indexRise = parseFloat(indexRiseInput.value) / 100;
  const officialRise = parseFloat(officialRiseInput.value) / 100;

  if (isNaN(nav) || isNaN(indexRise) || isNaN(officialRise)) {
    output.innerHTML = "âŒ æ•°æ®ä¸å®Œæ•´";
    return;
  }

  // === 1ï¸âƒ£ ä»“ä½åæ¨ï¼ˆé™åˆ¶åŒºé—´ï¼‰
  let position = officialRise / indexRise;
  if (!isFinite(position)) position = 1;
  position = Math.min(Math.max(position, 0.6), 1.0);

  // === 2ï¸âƒ£ å†å²å›å½’æ ¡å‡†ï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰
  let history = JSON.parse(localStorage.getItem("history") || "[]");

  history.push({
    x: indexRise * position,
    y: officialRise
  });

  if (history.length > 30) history.shift();
  localStorage.setItem("history", JSON.stringify(history));

  let a = 1, b = 0;
  if (history.length >= 5) {
    let sumX = 0, sumY = 0, sumXY = 0, sumXX = 0;
    history.forEach(p => {
      sumX += p.x;
      sumY += p.y;
      sumXY += p.x * p.y;
      sumXX += p.x * p.x;
    });
    const n = history.length;
    a = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX || 1);
    b = (sumY - a * sumX) / n;
  }

  // === 3ï¸âƒ£ å®æ—¶ä¼°å€¼
  const rawRise = indexRise * position;
  const adjRise = a * rawRise + b;
  const estNav = nav * (1 + adjRise);

  output.innerHTML = `
    ğŸ“ˆ ä¼°ç®—æ¶¨è·Œï¼š<b>${(adjRise * 100).toFixed(2)}%</b><br>
    ğŸ’° ä¼°ç®—å‡€å€¼ï¼š<b>${estNav.toFixed(4)}</b><br><br>
    <div class="small">
    ä»“ä½ä¼°è®¡ï¼š${(position * 100).toFixed(1)}%<br>
    å›å½’ç³»æ•° a=${a.toFixed(2)} b=${b.toFixed(4)}<br>
    æ ¡å‡†æ ·æœ¬æ•°ï¼š${history.length}
    </div>
  `;
}

// DOM
const navInput = document.getElementById("nav");
const indexRiseInput = document.getElementById("indexRise");
const officialRiseInput = document.getElementById("officialRise");
const output = document.getElementById("output");
</script>

</body>
</html>

